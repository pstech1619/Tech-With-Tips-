<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel | TechWithTips</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

<style>
body{
min-height:100vh;
background:linear-gradient(-45deg,#ff6b35,#ff9f1c,#ffd166,#ff6b35);
background-size:400% 400%;
animation:bgMove 18s ease infinite;
font-family:Segoe UI,Tahoma,sans-serif;
}
@keyframes bgMove{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}
.glass{
background:rgba(255,255,255,.92);
backdrop-filter:blur(18px);
border-radius:22px;
box-shadow:0 25px 60px rgba(0,0,0,.18);
}
.tab-btn{
padding:12px 26px;
font-weight:800;
border-radius:999px;
cursor:pointer;
}
.tab-active{
background:#2563eb;
color:#fff;
}
.hidden{display:none;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="lockScreen" class="min-h-screen flex items-center justify-center">
<div class="glass p-8 w-full max-w-sm text-center">
<h2 class="text-2xl font-extrabold mb-4">ğŸ” Admin Access</h2>
<input id="adminPassword" type="password" placeholder="Password"
class="w-full border p-3 rounded-xl mb-4 text-center">
<button onclick="checkPassword()"
class="w-full bg-orange-500 text-white py-3 rounded-full font-bold">
Enter Dashboard
</button>
</div>
</div>

<div id="adminPanel" style="display:none">

<header class="px-6 py-4 text-white bg-orange-500">
<h1 class="text-xl font-extrabold">ğŸš€ TechWithTips Admin Dashboard</h1>
</header>

<!-- STATS -->
<section class="grid grid-cols-2 md:grid-cols-4 gap-6 p-6 max-w-6xl mx-auto">
<div class="glass p-6"><p>Total Apps</p><p id="statApps" class="text-3xl font-bold">0</p></div>
<div class="glass p-6"><p>Total Blogs</p><p id="statBlogs" class="text-3xl font-bold">0</p></div>
<div class="glass p-6"><p>Featured Blogs</p><p id="statFeatured" class="text-3xl font-bold">0</p></div>
<div class="glass p-6"><p>New Apps</p><p id="statNewApps" class="text-3xl font-bold">0</p></div>
</section>

<!-- TABS -->
<div class="flex justify-center gap-4 mb-6">
<button class="tab-btn tab-active" onclick="openTab('appsTab',this)">ğŸ“± Apps</button>
<button class="tab-btn" onclick="openTab('blogsTab',this)">ğŸ“ Blogs</button>
</div>

<!-- ================= APPS TAB ================= -->
<section id="appsTab" class="max-w-6xl mx-auto p-6">

<div class="glass p-6 mb-8">
<h2 class="text-xl font-bold mb-4">â• Add / Edit App</h2>

<form onsubmit="saveApp(event)" class="grid gap-4 md:grid-cols-2">
<input type="hidden" id="editingId">
<input id="appName" required placeholder="App Name" class="border p-3 rounded-xl">
<input id="appSubtitle" required placeholder="Short Description" class="border p-3 rounded-xl">
<select id="appCategory" class="border p-3 rounded-xl">
<option value="all">All</option>
<option value="new">New</option>
</select>
<input type="file" id="appLogo" accept="image/*" class="border p-3 rounded-xl">
<input id="appUrl" required placeholder="Download URL" class="border p-3 rounded-xl md:col-span-2">
<button class="md:col-span-2 bg-blue-600 text-white py-3 rounded-full font-bold">
â­ Save as #1 App
</button>
</form>
<p class="text-sm text-gray-600 mt-2">âœ¨ <strong>Auto-ranking:</strong> Naya app hamesha #1 par aayega, baaki apps automatic rearrange ho jayenge!</p>
</div>

<div class="glass p-6">
<h2 class="text-xl font-bold mb-4">ğŸ“‹ All Apps (Auto-ranked)</h2>
<table class="w-full border text-sm">
<thead class="bg-blue-100">
<tr><th>#</th><th>Name</th><th>Logo</th><th>Category</th><th>Action</th></tr>
</thead>
<tbody id="appsTable"></tbody>
</table>
</div>

</section>

<!-- ================= BLOGS TAB ================= -->
<section id="blogsTab" class="max-w-6xl mx-auto p-6 hidden">

<div class="glass p-6 mb-8">
<h2 class="text-xl font-bold mb-4">ğŸ“ Add / Edit Blog</h2>

<form onsubmit="saveBlog(event)" class="grid gap-4">
<input type="hidden" id="blogId">
<input id="blogTitle" required placeholder="Blog Title" class="border p-3 rounded-xl">
<input id="blogSlug" required placeholder="Slug" class="border p-3 rounded-xl">
<input id="blogCategory" placeholder="Category" class="border p-3 rounded-xl">
<input type="file" id="blogImage" accept="image/*" class="border p-3 rounded-xl">
<textarea id="blogContent" rows="6" required placeholder="Blog Content"
class="border p-3 rounded-xl"></textarea>
<label class="flex gap-2 items-center font-semibold">
<input type="checkbox" id="blogFeatured"> â­ Featured
</label>
<button id="blogSubmitBtn" class="bg-green-600 text-white py-3 rounded-full font-bold">
Publish Blog
</button>
</form>
</div>

<div class="glass p-6">
<h2 class="text-xl font-bold mb-4">ğŸ“š All Blogs</h2>
<table class="w-full border text-sm">
<thead class="bg-green-100">
<tr><th>Thumbnail</th><th>Title</th><th>Category</th><th>Featured</th><th>Action</th></tr>
</thead>
<tbody id="blogsTable"></tbody>
</table>
</div>

</section>

</div>

<!-- BASIC JS -->
<script>
const ADMIN_PASS="775993";
function checkPassword(){
if(adminPassword.value===ADMIN_PASS){
lockScreen.style.display="none";
adminPanel.style.display="block";
}else alert("Wrong Password");
}

function openTab(id,btn){
document.querySelectorAll('[id$="Tab"]').forEach(t=>t.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove("tab-active"));
btn.classList.add("tab-active");
}
</script>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const app = initializeApp({
apiKey:"AIzaSyBwC35sh20ttnUeNsMOi8ghzsab-Db_6c4",
databaseURL:"https://pawan-9dd64-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(app);

const appsRef = ref(db,"apps");
const blogsRef = ref(db,"blogs");

let apps=[], blogs=[];

/* LOAD APPS */
onValue(appsRef,s=>{
apps = Object.entries(s.val()||{}).map(([id,v])=>({id,...v}));
apps.sort((a,b)=> new Date(b.timestamp||0) - new Date(a.timestamp||0));

statApps.textContent = apps.length;
statNewApps.textContent = apps.filter(a=>a.category==="new").length;

appsTable.innerHTML = apps.map((a,i)=>`
<tr>
<td class="font-bold text-orange-600">#${i+1}</td>
<td>${a.name}</td>
<td>${a.logo ? `<img src="${a.logo}" class="w-8 h-8 object-cover rounded">` : 'No Logo'}</td>
<td><span class="px-2 py-1 rounded-full text-xs ${a.category==='new'?'bg-green-200 text-green-800':'bg-gray-200'}">${a.category}</span></td>
<td>
<button onclick="editApp('${a.id}')" class="text-blue-600 hover:underline">Edit</button>
<button onclick="deleteApp('${a.id}')" class="text-red-600 ml-2 hover:underline">Delete</button>
</td>
</tr>`).join("");
});

/* SAVE APP */
window.saveApp = async e=>{
e.preventDefault();
const logoFile = appLogo.files[0];
let logoUrl = apps.find(a=>a.id===editingId.value)?.logo || '';

if(logoFile){
const reader = new FileReader();
reader.onload = async (e) => {
logoUrl = e.target.result;
await saveAppData(logoUrl);
};
reader.readAsDataURL(logoFile);
} else {
await saveAppData(logoUrl);
}
};

async function saveAppData(logoUrl) {
const data={
name:appName.value,
subtitle:appSubtitle.value,
category:appCategory.value,
url:appUrl.value,
logo:logoUrl,
timestamp: new Date().toISOString()
};
if(editingId.value){
await update(ref(db,"apps/"+editingId.value),data);
}else{
await push(appsRef,data);
}
editingId.value="";
document.querySelector('form[onsubmit="saveApp(event)"]').reset();
appLogo.value='';
}

/* EDIT APP */
window.editApp = id=>{
const a=apps.find(x=>x.id===id);
editingId.value=a.id;
appName.value=a.name;
appSubtitle.value=a.subtitle;
appCategory.value=a.category;
appUrl.value=a.url;
};

/* DELETE APP */
window.deleteApp=id=>confirm('Delete this app?') && remove(ref(db,"apps/"+id));

/* BLOGS */
onValue(blogsRef,s=>{
blogs = Object.entries(s.val()||{}).map(([id,v])=>({id,...v}));
statBlogs.textContent=blogs.length;
statFeatured.textContent=blogs.filter(b=>b.featured).length;

blogsTable.innerHTML=blogs.map(b=>`
<tr>
<td>${b.image ? `<img src="${b.image}" class="w-10 h-10 object-cover rounded">` : 'No Image'}</td>
<td>${b.title}</td>
<td>${b.category||"-"}</td>
<td>${b.featured?"â­":""}</td>
<td>
<button onclick="editBlog('${b.id}')" class="text-blue-600 hover:underline">Edit</button>
<button onclick="deleteBlog('${b.id}')" class="text-red-600 ml-2 hover:underline">Delete</button>
</td>
</tr>`).join("");
});

/* SAVE BLOG WITH IMAGE + EDIT */
window.saveBlog = async e=>{
e.preventDefault();
const file = blogImage.files[0];
const editingBlogId = blogId.value;
const submitBtn = document.getElementById('blogSubmitBtn');

const existing = blogs.find(b => b.id === editingBlogId);
let oldImage = existing ? (existing.image || "") : "";

const baseData = {
title:blogTitle.value,
slug:blogSlug.value,
category:blogCategory.value,
content:blogContent.value,
featured:blogFeatured.checked,
date: existing ? (existing.date || new Date().toISOString()) : new Date().toISOString()
};

if(file){
const reader = new FileReader();
reader.onload = async ev => {
const imageData = ev.target.result;
const data = {...baseData, image:imageData};

if(editingBlogId){
await update(ref(db,"blogs/"+editingBlogId), data);
}else{
await push(blogsRef, data);
}
e.target.reset();
blogId.value = "";
blogImage.value = "";
submitBtn.textContent = "Publish Blog";
};
reader.readAsDataURL(file);
} else {
const data = {...baseData, image: oldImage};
if(editingBlogId){
await update(ref(db,"blogs/"+editingBlogId), data);
}else{
await push(blogsRef, data);
}
e.target.reset();
blogId.value = "";
submitBtn.textContent = "Publish Blog";
}
};

/* EDIT BLOG */
window.editBlog = id=>{
const b=blogs.find(x=>x.id===id);
blogId.value=b.id;
blogTitle.value=b.title;
blogSlug.value=b.slug;
blogCategory.value=b.category||"";
blogContent.value=b.content||"";
blogFeatured.checked=!!b.featured;
blogImage.value="";
document.getElementById('blogSubmitBtn').textContent = "Update Blog";
};

/* DELETE BLOG */
window.deleteBlog=id=>confirm('Delete this blog?') && remove(ref(db,"blogs/"+id));
</script>

</body>
</html>

